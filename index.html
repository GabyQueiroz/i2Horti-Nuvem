<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>i2Horti ‚Ä¢ Painel de Irriga√ß√£o em Nuvem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" type="image/png" href="imagens/logo_cor.png" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- ================= LANDING / SELE√á√ÉO DE PROPRIEDADE ================= -->
  <section id="landing" class="landing">
    <header class="landing-header">
      <div class="landing-title">
        <img
          src="imagens/logo_cor.png"
          class="landing-logo"
          alt="Logo i2Horti"
        />
        <div class="landing-title-text">
          <h1>i2Horti ‚Ä¢ Painel de Irriga√ß√£o da Nuvem</h1>
          <p>Selecione a propriedade para visualizar clima, canteiros e decis√µes de irriga√ß√£o.</p>
        </div>
      </div>
    </header>

    <div class="landing-grid">
      <!-- Dois Vizinhos ‚Äì ATIVO -->
      <article class="landing-card landing-card-active" data-farm="doisvizinhos">
        <div class="landing-card-badge">Ativo</div>
        <h2>Dois Vizinhos</h2>
        <p>Propriedade conectada √† nuvem. Visualize previs√µes, canteiros e planos de irriga√ß√£o.</p>
        <div class="landing-card-meta">
          <span>üìç PR</span>
          <span>Modo: Produ√ß√£o</span>
        </div>
        <button class="landing-card-button" type="button">
          Abrir dashboard
        </button>
      </article>

      <!-- Curitiba ‚Äì EM BREVE -->
      <article class="landing-card landing-card-disabled" data-farm="curitiba">
        <div class="landing-card-badge badge-soon">Em breve</div>
        <h2>Curitiba</h2>
        <p>Integra√ß√£o em configura√ß√£o. Em breve os dados desta unidade estar√£o dispon√≠veis.</p>
        <div class="landing-card-meta">
          <span>üìç Curitiba</span>
          <span>Sem dados</span>
        </div>
        <div class="landing-card-hint">
          Aguardando conex√£o com esta√ß√£o e sensores.
        </div>
      </article>

      <!-- Miringuava ‚Äì Francisco -->
      <article class="landing-card landing-card-disabled" data-farm="miringuava-francisco">
        <div class="landing-card-badge badge-soon">Em breve</div>
        <h2>Miringuava ‚Ä¢ Francisco</h2>
        <p>Propriedade registrada, ainda sem telemetria enviada para a nuvem.</p>
        <div class="landing-card-meta">
          <span>üìç Miringuava</span>
          <span>Sem dados</span>
        </div>
        <div class="landing-card-hint">
          Integra√ß√£o com sensores em fase de planejamento.
        </div>
      </article>

      <!-- Miringuava ‚Äì Rosaldo -->
      <article class="landing-card landing-card-disabled" data-farm="miringuava-rosaldo">
        <div class="landing-card-badge badge-soon">Em breve</div>
        <h2>Miringuava ‚Ä¢ Rosaldo</h2>
        <p>Propriedade registrada, ainda sem telemetria enviada para a nuvem.</p>
        <div class="landing-card-meta">
          <span>üìç Miringuava</span>
          <span>Sem dados</span>
        </div>
        <div class="landing-card-hint">
          Integra√ß√£o com sensores em fase de planejamento.
        </div>
      </article>

      <!-- Miringuava ‚Äì Luciane -->
      <article class="landing-card landing-card-disabled" data-farm="miringuava-luciane">
        <div class="landing-card-badge badge-soon">Em breve</div>
        <h2>Miringuava ‚Ä¢ Luciane</h2>
        <p>Propriedade registrada, ainda sem telemetria enviada para a nuvem.</p>
        <div class="landing-card-meta">
          <span>üìç Miringuava</span>
          <span>Sem dados</span>
        </div>
        <div class="landing-card-hint">
          Integra√ß√£o com sensores em fase de planejamento.
        </div>
      </article>
    </div>

    <footer class="landing-footer">
      <span>&copy; <span id="landingYear"></span> i2Horti ‚Ä¢ Irriga√ß√£o Inteligente em Nuvem</span>
    </footer>
  </section>

  <!-- ================= DASHBOARD PRINCIPAL ================= -->
  <div id="appWrapper" class="app-wrapper app-hidden">
    <header class="app-header">
      <div class="app-header-left">
        <button id="backToLanding" class="back-button" type="button">
          ‚Üê Escolher propriedade
        </button>

        <div class="app-header-info">
          <span class="farm-pill">Propriedade: Dois Vizinhos</span>

          <div class="title-with-icon">
            <img src="imagens/logo_cor.png" class="title-icon" alt="√çcone i2Horti" />
            <div class="landing-title-text">
              <h1>Dashboard de Irriga√ß√£o</h1>
            </div>
          </div>

          <p class="subtitle">
            Dados publicados na AWS IoT e armazenados no S3
            (<code>raspbpibucket/dashboard/</code>) para a unidade Dois Vizinhos.
          </p>

          <!-- Estiliza√ß√£o local da √°rea do t√≠tulo -->
          <style>
            .title-with-icon {
              display: flex;
              align-items: center;
              gap: 6px;
              margin-left: -10px;
            }

            .title-icon {
              width: 48px;
              height: 48px;
              object-fit: contain;
              border-radius: 8px;
            }
          </style>
        </div>
      </div>

      <div class="app-header-right">
        <nav class="app-nav">
          <button id="navDashboard" class="nav-button nav-button-active" type="button">
            Vis√£o em tempo real
          </button>
          <button id="navHistory" class="nav-button" type="button">
            Hist√≥rico e an√°lises
          </button>
        </nav>

        <div class="app-controls">
          <label class="auto-refresh-label">
            <input type="checkbox" id="autoRefreshCheckbox" />
            Atualizar a cada 60s
          </label>
          <button id="refreshButton" type="button">Atualizar agora</button>
          <span id="lastUpdate" class="last-update">√öltima atualiza√ß√£o: --</span>
        </div>
      </div>
    </header>

    <main class="app-main">
      <!-- =============== VIEW: DASHBOARD TEMPO REAL =============== -->
      <section id="dashboardView" class="view view-active">
        <!-- Destaques RBS / RL -->
        <section class="highlight-strip">
          <article class="highlight-card" id="highlightRBS">
            <h2>√öltima decis√£o RBS</h2>
            <p class="highlight-info" id="highlightRbsInfo">Carregando...</p>
            <p class="highlight-mini" id="highlightRbsExtra"></p>
          </article>

          <article class="highlight-card" id="highlightRL">
            <h2>√öltima decis√£o RL (PPO)</h2>
            <p class="highlight-info" id="highlightRlInfo">Carregando...</p>
            <p class="highlight-mini" id="highlightRlExtra"></p>
          </article>
        </section>

        <!-- Cards por t√≥pico -->
        <section class="section">
          <div class="section-header">
            <div>
              <h2>T√≥picos monitorados</h2>
              <p class="section-description">
                Os cards mostram os t√≥picos MQTT da unidade <strong>Dois Vizinhos</strong>.
                Use o filtro abaixo para aplicar a mesma data/hor√°rio em todos os cards
                com hist√≥rico (previs√£o, Plugfield, RBS e RL).
              </p>
            </div>
          </div>

          <!-- Filtro global (data + hor√°rio) -->
          <div class="filter-bar">
            <div class="filter-bar-header">
              <h3>Filtro geral de data e hor√°rio</h3>
              <span class="filter-tag">
                Aplica-se aos cards de previs√£o, Plugfield e decis√µes de irriga√ß√£o (RBS e RL).
              </span>
            </div>

            <div class="filter-controls">
              <label>
                Data
                <input type="date" id="globalFilterDate" />
              </label>
              <label>
                Hor√°rio (opcional)
                <input type="time" id="globalFilterTime" step="60" />
              </label>
              <button id="globalFilterApply" type="button">Aplicar filtro</button>
              <button id="globalFilterClear" type="button" class="btn-secondary">
                Limpar
              </button>
            </div>

            <p class="filter-info" id="rbsFilterInfo">
              Mostrando a √∫ltima decis√£o de irriga√ß√£o RBS dispon√≠vel (sem filtro de data/hor√°rio).
            </p>
          </div>

          <!-- Cards gerados dinamicamente -->
          <div id="cardsContainer" class="cards-container"></div>
        </section>
      </section>

      <!-- =============== VIEW: HIST√ìRICO E AN√ÅLISES =============== -->
      <section id="historyView" class="view view-hidden">
        <header class="history-header">
          <div>
            <h2>Hist√≥rico de Irriga√ß√µes e Previs√µes</h2>
            <p>
              Explore todas as decis√µes RBS e RL, filtre por data/hor√°rio
              e visualize um gr√°fico comparativo das irriga√ß√µes.
            </p>
          </div>
        </header>

        <!-- Sele√ß√£o de plantio -->
        <section class="planting-selector-section">
          <div class="planting-selector-header">
            <h3>Selecione o plantio</h3>
            <p class="planting-selector-description">
              Cada plantio √© identificado a partir dos dados cadastrados.
              Ao selecionar um plantio, o hist√≥rico abaixo √© filtrado automaticamente
              para o intervalo de datas de <strong>plantio</strong> e <strong>colheita prevista</strong>.
            </p>
          </div>

          <div
            id="plantingButtonsContainer"
            class="planting-buttons-container modern-planting-buttons">
          </div>

          <p id="plantingSelectedInfo" class="planting-selected-info">
            Nenhum plantio selecionado. Mostrando registros de toda a temporada.
          </p>
        </section>

        <!-- Filtros do hist√≥rico -->
        <section class="history-filters">
          <div class="history-filter-row">
            <label>
              Data inicial
              <input type="date" id="histDateStart" />
            </label>
            <label>
              Data final
              <input type="date" id="histDateEnd" />
            </label>
            <label>
              Hor√°rio inicial
              <input type="time" id="histTimeStart" step="60" />
            </label>
            <label>
              Hor√°rio final
              <input type="time" id="histTimeEnd" step="60" />
            </label>
            <label>
              M√©todo
              <select id="histMethod">
                <option value="all">RBS + RL</option>
                <option value="rbs">Somente RBS</option>
                <option value="rl">Somente RL</option>
              </select>
            </label>
          </div>
          <div class="history-filter-actions">
            <button id="histApply" type="button">Aplicar filtros</button>
            <button id="histClear" type="button" class="btn-secondary">Limpar</button>
          </div>
          <p id="histInfo" class="history-info">
            Carregando dados de hist√≥rico...
          </p>
        </section>

        <!-- Gr√°fico -->
        <section class="history-chart-section">
          <h3>Gr√°fico de l√¢minas de irriga√ß√£o (RBS √ó RL)</h3>
          <p class="history-chart-subtitle">
            Cada barra representa a l√¢mina di√°ria acumulada por m√©todo.
            Passe o mouse para ver os valores exatos.
          </p>
          <div class="history-chart-wrapper">
            <canvas id="historyChart"></canvas>
          </div>
        </section>

        <!-- Tabela de hist√≥rico (SEM coluna de chuva) -->
        <section class="history-table-section">
          <h3>Registros filtrados</h3>
          <div class="history-table-wrapper">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Hor√°rio</th>
                  <th>M√©todo</th>
                  <th>Canteiro</th>
                  <th>Volume (mm)</th>
                  <th>Tipo / Regra</th>
                </tr>
              </thead>
              <tbody id="historyTableBody">
              </tbody>
            </table>
          </div>
        </section>

        <!-- Resumo de Totais -->
        <section id="irrigationSummary" class="irrigation-summary">
        </section>
      </section>
    </main>

    <footer class="app-footer">
      <p>Sistema de Irriga√ß√£o Inteligente ‚Ä¢ <span id="year"></span></p>
    </footer>
  </div>

  <!-- Chart.js para o gr√°fico do hist√≥rico -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
</body>
</html>
